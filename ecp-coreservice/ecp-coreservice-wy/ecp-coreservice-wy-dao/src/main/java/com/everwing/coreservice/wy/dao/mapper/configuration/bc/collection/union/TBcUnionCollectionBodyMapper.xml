<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.everwing.coreservice.wy.dao.mapper.configuration.bc.collection.union.TBcUnionCollectionBodyMapper" >	<resultMap type="TBcUnionCollectionBody" id="BaseResultMap">		<result property="id" 					column="id"						jdbcType="VARCHAR"/>		<result property="headId" 				column="head_id"				jdbcType="VARCHAR"/>		<result property="billId" 				column="bill_id"				jdbcType="VARCHAR"/>		<result property="orderNo" 				column="order_no"				jdbcType="VARCHAR"/>		<result property="bankNo" 				column="bank_no"				jdbcType="VARCHAR"/>		<result property="isCard" 				column="is_card"				jdbcType="TINYINT"/>		<result property="bankCardNo" 			column="bank_card_no"			jdbcType="VARCHAR"/>		<result property="idCardMasterName" 	column="id_card_master_name"	jdbcType="VARCHAR"/>		<result property="idCardType" 			column="id_card_type"			jdbcType="VARCHAR"/>		<result property="idCardNo" 			column="id_card_no"				jdbcType="VARCHAR"/>		<result property="amount"			 	column="amount"					jdbcType="DOUBLE"/>		<result property="use" 					column="use"					jdbcType="VARCHAR"/>		<result property="privateZone" 			column="private_zone"			jdbcType="VARCHAR"/>		<result property="createId" 			column="create_id"				jdbcType="VARCHAR"/>		<result property="createTime" 			column="create_time"			jdbcType="TIMESTAMP"/>		<result property="modifyId" 			column="modify_id"				jdbcType="VARCHAR"/>		<result property="modifyTime" 			column="modify_time"			jdbcType="TIMESTAMP"/>		<result property="buildingCode"			column="building_code"			jdbcType="VARCHAR"/>		<result property="buildingFullName"		column="building_full_name"		jdbcType="VARCHAR"/>		<result property="custId"				column="cust_id"				jdbcType="VARCHAR"/>		<result property="custName"				column="cust_name"				jdbcType="VARCHAR"/>		<result property="projectId"			column="project_id"				jdbcType="VARCHAR"/>		<result property="wyAmount"			 	column="wy_amount"				jdbcType="DOUBLE"/>		<result property="btAmount"			 	column="bt_amount"				jdbcType="DOUBLE"/>		<result property="waterAmount"			column="water_amount"			jdbcType="DOUBLE"/>		<result property="electAmount"			column="elect_amount"			jdbcType="DOUBLE"/>		<result property="serviceAmount"		column="service_amount"			jdbcType="DOUBLE"/>	</resultMap>		<sql id="sql_search_where">		<if test="null != id">					and id = #{id}				</if>		<if test="null != headId"> 				and head_id = #{headId}	 	</if>		<if test="null != idCardMasterName">	and id_card_master_name like CONCAT('%',#{idCardMasterName},'%')	</if>		<if test="null != use">					and `use` like CONCAT('%',#{use},'%')	</if>	</sql>	<update id="update" parameterType="TBcUnionCollectionBody">		update t_bc_union_collection_body		<set>			<if test="null != headId"> head_id = #{headId}, </if>			<if test="null != billId"> bill_id = #{billId}, </if>			<if test="null != orderNo">order_no = #{orderNo},</if>			<if test="null != bankNo"> bank_no = #{bankNo}, </if>			<if test="null != bankCardNo"> bank_card_no = #{bankCardNo}, </if>			<if test="null != idCardMasterName"> id_card_master_name = #{idCardMasterName}, </if>			<if test="null != idCardType"> id_card_type = #{idCardType}, </if>			<if test="null != idCardNo"> id_card_no = #{idCardNo}, </if>			<if test="null != amount"> amount = #{amount}, </if>			<if test="null != use"> `use` = #{use}, </if>			<if test="null != createTime"> create_time = #{createTime}, </if>			<if test="null != modifyId"> modify_id = #{modifyId}, </if>			<if test="null != buildingCode"> building_code = #{buildingCode},</if>			<if test="null != buildingFullName"> building_full_name = #{buildingFullName}, </if>			<if test="null != custId"> cust_id = #{custId}, </if>			<if test="null != custName"> cust_name = #{custName}, </if>			<if test="null != wyAmount"> wy_amount = #{wyAmount}, </if>			<if test="null != btAmount"> bt_amount = #{btAmount}, </if>			<if test="null != waterAmount"> water_amount = #{waterAmount}, </if>			<if test="null != electAmount"> elect_amount = #{electAmount}, </if>			<if test="null != serviceAmount"> service_amount = #{serviceAmount}, </if>			modify_time = sysdate()		</set>		where id = #{id}	</update>	<select id="listPage" parameterType="TBcUnionCollectionBody" resultMap="BaseResultMap">		select * from t_bc_union_collection_body		where 1 = 1		<include refid="sql_search_where"/>	</select>		<select id="findAllByHeadId" parameterType="String" resultMap="BaseResultMap">		select * from t_bc_union_collection_body		where head_id = #{0}	</select>		<select id="findFailedBodies" parameterType="String" resultMap="BaseResultMap">		SELECT t1.* FROM t_bc_union_collection_body t1 , t_bc_union_collection_head t2		  WHERE t1.head_id = t2.id		    AND t1.head_id = #{0}		    AND t1.building_code NOT IN (			SELECT t3.building_code FROM t_bc_union_back_body t3, t_bc_union_back_head t4			WHERE t3.head_id = t4.id			AND t4.total_id = t2.total_id			AND t3.trade_status = 1001 			AND t3.resp_code = 00		    )		order by t1.order_no asc	</select>		<select id="countByHeadId" parameterType="String" resultType="Integer">		select count(0) from t_bc_union_collection_body where head_id = #{0}	</select>		<select id="sumAmountByHeadId" parameterType="String" resultType="Double">		select sum(amount) from t_bc_union_collection_body where head_id = #{0}	</select>		<select id="findOrderNoByHeadId" parameterType="String" resultType="String">		SELECT LPAD(COUNT(id) + 1,16,'0') as orderNo FROM t_bc_union_collection_body t WHERE head_id = #{0}	</select>		<insert id="insert" parameterType="TBcUnionCollectionBody">		insert into t_bc_union_collection_body		(			id,			head_id,			bill_id,			order_no,			bank_no,			is_card,			bank_card_no,			id_card_master_name,			id_card_type,			id_card_no,			amount,			`use`,			private_zone,			create_id,			create_time,			modify_id,			modify_time,			building_code,			building_full_name,			cust_id,			cust_name,			project_id,			wy_amount,			bt_amount,			water_amount,			elect_amount,			service_amount		)		values		(			#{id},			#{headId},			#{billId},			#{orderNo},			#{bankNo},			#{isCard},			#{bankCardNo},			#{idCardMasterName},			#{idCardType},			#{idCardNo},			#{amount},			#{use},			#{privateZone},			#{createId},			#{createTime},			#{modifyId},			#{modifyTime},			#{buildingCode},			#{buildingFullName},			#{custId},			#{custName},			#{projectId},			#{wyAmount},			#{btAmount},			#{waterAmount},			#{electAmount},			#{serviceAmount}		)	</insert>	<insert id="batchInsert" parameterType="TBcUnionCollectionBody">		insert into t_bc_union_collection_body		(			id,			head_id,			bill_id,			order_no,			bank_no,			is_card,			bank_card_no,			id_card_master_name,			id_card_type,			id_card_no,			amount,			`use`,			private_zone,			create_id,			create_time,			modify_id,			modify_time,			building_code,			building_full_name,			cust_id,			cust_name,			project_id,			wy_amount,			bt_amount,			water_amount,			elect_amount,			service_amount		)		values		<foreach collection="list" item="body" close="" open="" separator=",">		(			#{body.id},			#{body.headId},			#{body.billId},			#{body.orderNo},			#{body.bankNo},			#{body.isCard},			#{body.bankCardNo},			#{body.idCardMasterName},			#{body.idCardType},			#{body.idCardNo},			#{body.amount},			#{body.use},			#{body.privateZone},			#{body.createId},			#{body.createTime},			#{body.modifyId},			#{body.modifyTime},			#{body.buildingCode},			#{body.buildingFullName},			#{body.custId},			#{body.custName},			#{body.projectId},			#{body.wyAmount},			#{body.btAmount},			#{body.waterAmount},			#{body.electAmount},			#{body.serviceAmount}		)		</foreach>	</insert>		<select id="findByHeadIdAndOrderId" resultMap="BaseResultMap">		select * from t_bc_union_collection_body 		where head_id = #{headId}		  and order_no = #{orderNo}	</select>		<select id="sumTotalAmountByTotalId" parameterType="String" resultType="Double">		SELECT SUM(t1.amount) FROM t_bc_union_collection_body t1, t_bc_union_collection_head t2		WHERE t1.head_id = t2.id		AND t2.total_id = #{0}	</select>			<select id="getThisCollectionInfo" parameterType = "java.lang.String" resultMap = "BaseResultMap">		SELECT			id,amount		FROM			t_bc_union_collection_body		WHERE			head_id IN (				SELECT					id				FROM					t_bc_union_collection_head				WHERE					total_id IN (						SELECT							id						FROM							t_bc_collection_total						WHERE							project_id = #{projectId}						AND collection_type = 0						AND collection_status = 0						AND is_wait_back IS NULL						AND DATE_FORMAT(modify_time, '%Y-%m-%d') = DATE_FORMAT(SYSDATE(), '%Y-%m-%d')					)			)	</select>				<update id="batchUpdate" parameterType="TBcUnionCollectionBody">		<foreach collection="list" item="body" close="" open="" separator=";">			UPDATE t_bc_union_collection_body set amount =  #{body.amount} where id = #{body.id}		</foreach>	</update>				</mapper>