<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.everwing.coreservice.wy.dao.mapper.product.TDepositMapper">	<!-- 押金表 -->	<resultMap type="TDeposit" id="BaseResultMap">		<result property="id" column="id"/>		<result property="projectId" column="project_id"/>		<result property="name" column="name"/>		<result property="payDepositDatetime" column="pay_deposit_datetime"/>		<result property="totalAmount" column="total_amount"/>		<result property="depositPerson" column="deposit_person"/>		<result property="orderBatchNo" column="order_batch_no"/>		<result property="status" column="status"/>		<result property="createrId" column="creater_id"/>		<result property="createrName" column="creater_name"/>		<result property="modifyId" column="modify_id"/>		<result property="modifyName" column="modify_name"/>		<result property="createTime" column="create_time"/>		<result property="modifyTime" column="modify_time"/>	</resultMap>	<resultMap id="ListResultMap" type="TDepositList" extends="BaseResultMap">		<result property="statusName" column="status_name"/>		<result property="returnedPrice" column="returned_price"/>		<result property="deductAmount" column="deduct_amount"/>		<result property="personCustName" column="person_cust_name"/>		<result property="personCustPhone" column="person_cust_phone"/>		<result property="enterpriseCustName" column="enterprise_cust_name"/>		<result property="enterpriseCustPhone" column="enterprise_cust_phone"/>	</resultMap>	<!-- 退押金明细表 -->	<resultMap type="TDepositDetail" id="TDepositDetailResultMap">		<result property="id" column="id"/>		<result property="depositId" column="deposit_id"/>		<result property="orderNumber" column="order_number"/>		<result property="redeemDeposiAmount" column="redeem_deposi_amount"/>		<result property="deductAmount" column="deduct_amount"/>		<result property="redeemDepositDatetime" column="redeem_deposit_datetime"/>		<result property="description" column="description"/>	</resultMap>	<resultMap id="TDepositDetailListResultMap" type="TDepositDetailList" extends="TDepositDetailResultMap">		<result property="payTypeNames" column="pay_type_names"/>	</resultMap>	<!-- 分页查询押金表 -->	<select id="listPage" resultMap="ListResultMap" parameterType="TDepositSearch">		SELECT			t.*,			pc.`name` AS person_cust_name,			pc.register_phone AS person_cust_phone,			ec.enterprise_name AS enterprise_cust_name,			ec.office_phone AS enterprise_cust_phone,			(SELECT IFNULL(SUM(dd.redeem_deposi_amount),0) FROM t_deposit_detail dd WHERE dd.deposit_id = t.id) AS returned_price,			(SELECT IFNULL(SUM(dd.deduct_amount),0) FROM t_deposit_detail dd WHERE dd.deposit_id = t.id) AS deduct_amount		FROM			t_deposit t LEFT JOIN tc_person_cust pc ON t.deposit_person = pc.cust_id LEFT JOIN tc_enterprise_cust ec ON t.deposit_person = ec.enterprise_id		WHERE 1 = 1		<if test="id != null and id != ''">			AND t.id = #{id}		</if>		<if test="projectId != null and projectId != ''">			AND t.project_id = #{projectId}		</if>		<if test="depositPerson != null and depositPerson != ''">			AND t.deposit_person = #{depositPerson}		</if>		<if test="name != null and name != ''">			AND t.name = LIKE CONCAT('%',#{name},'%')		</if>		<if test="status != null and status != ''">			AND t.status = #{status}		</if>		<if test="orderBatchNo != null and orderBatchNo != ''">			AND t.order_batch_no = #{orderBatchNo}		</if>	</select>	<!-- 根据条件查询押金表 -->	<select id="findByCondition" resultMap="ListResultMap" parameterType="TDepositSearch">		SELECT			t.*,			(SELECT IFNULL(SUM(dd.redeem_deposi_amount),0) FROM t_deposit_detail dd WHERE dd.deposit_id = t.id) AS returned_price,			(SELECT IFNULL(SUM(dd.deduct_amount),0) FROM t_deposit_detail dd WHERE dd.deposit_id = t.id) AS deduct_amount		FROM			t_deposit t		WHERE		1 = 1		<if test="id != null and id != ''">			AND t.id = #{id}		</if>		<if test="projectId != null and projectId != ''">			AND t.project_id = #{projectId}		</if>		<if test="status != null and status != ''">			AND t.status = #{status}		</if>		<if test="custName != null and custName != ''">			AND t.deposit_person LIKE CONCAT('%',#{custName},'%')		</if>		<if test="regPhone != null and regPhone != ''">			AND t.deposit_person LIKE CONCAT('%',#{regPhone},'%')		</if>		<if test="orderBatchNo != null and orderBatchNo != ''">			AND t.order_batch_no = #{orderBatchNo}		</if>	</select>	<!-- 批量插入押金表 -->	<insert id="batchInsert" parameterType="java.util.List">		insert into t_deposit(			id,			project_id,			name,			pay_deposit_datetime,			total_amount,			deposit_person,			order_batch_no,			status,			creater_id,			creater_name,			modify_id,			modify_name,			create_time,			modify_time		)		values		<foreach collection="list" index="index" item="item" separator=",">			(				UUID(),				#{item.projectId},				#{item.name},				#{item.payDepositDatetime},				#{item.totalAmount},				#{item.depositPerson},				#{item.orderBatchNo},				#{item.status},				#{item.createrId},				#{item.createrName},				'',				'',				sysdate(),				sysdate()			)		</foreach>	</insert>	<!-- 更新押金表 -->	<update id="modify" parameterType="TDeposit">		UPDATE t_deposit SET			status = #{status},			modify_id = #{modifyId},			modify_name = #{modifyName},			modify_time = sysdate()		WHERE id = #{id}	</update>	<select id="findTDepositDetailByCondition" resultMap="TDepositDetailListResultMap" parameterType="TDepositDetailSearch">		SELECT * FROM t_deposit_detail t WHERE 1=1		<if test="id != null and id != ''">			AND t.id = #{id}		</if>		<if test="depositId != null and depositId != ''">			AND t.deposit_id = #{depositId}		</if>		<if test="orderNumber != null and orderNumber != ''">			AND t.order_number = #{orderNumber}		</if>	</select>	<!-- 根据id查询退押明细 -->	<select id="findDepositDetailByDepositId" resultMap="TDepositDetailListResultMap" parameterType="String">		SELECT t1.*,GROUP_CONCAT(li.`name`) AS pay_type_names FROM		(			SELECT				dd.*,				ppd.pay_type			FROM			t_deposit_detail dd LEFT JOIN t_product_payment_detail ppd ON dd.id = ppd.deposit_detail_id			WHERE 1=1			AND dd.deposit_id = #{0}		) t1 LEFT JOIN t_sys_lookup_item li ON t1.pay_type = li.`code`		WHERE li.parent_code = 'payType'		GROUP BY t1.id	</select>	<!-- 插入退押明细 -->	<insert id="insertTDepositDetail" parameterType="java.util.List">		insert into t_deposit_detail(			id,			deposit_id,			order_number,			redeem_deposi_amount,			deduct_amount,			redeem_deposit_datetime,			description		)		values		(			#{id},			#{depositId},			#{orderNumber},			#{redeemDeposiAmount},			#{deductAmount},			sysdate(),			#{description}		)	</insert></mapper>