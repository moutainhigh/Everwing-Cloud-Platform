<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.everwing.coreservice.wy.dao.mapper.configuration.bc.collection.union.back.TBcUnionBackBodyMapper" >	<resultMap type="TBcUnionBackBody" id="BaseResultMap">		<result property="id" 					column="id"						jdbcType="VARCHAR"/>		<result property="headId" 				column="head_id"				jdbcType="VARCHAR"/>		<result property="bankNo" 				column="bank_no"				jdbcType="VARCHAR"/>		<result property="tradeDate" 			column="trade_date"				jdbcType="TIMESTAMP"/>		<result property="orderNo" 				column="order_no"				jdbcType="VARCHAR"/>		<result property="tradeStatus" 			column="trade_status"			jdbcType="INTEGER"/>		<result property="respCode" 			column="resp_code"				jdbcType="VARCHAR"/>		<result property="isBankCard" 			column="is_bank_card"			jdbcType="INTEGER"/>		<result property="bankCardNo" 			column="bank_card_no"			jdbcType="VARCHAR"/>		<result property="amount" 				column="amount"					jdbcType="DOUBLE"/>		<result property="use" 					column="use"					jdbcType="VARCHAR"/>		<result property="privateZone" 			column="private_zone"			jdbcType="VARCHAR"/>		<result property="createId" 			column="create_id"				jdbcType="VARCHAR"/>		<result property="createTime" 			column="create_time"			jdbcType="TIMESTAMP"/>		<result property="modifyId" 			column="modify_id"				jdbcType="VARCHAR"/>		<result property="modifyTime" 			column="modify_time"			jdbcType="TIMESTAMP"/>		<result property="buildingCode"			column="building_code"			jdbcType="VARCHAR"/>		<result property="buildingFullName"		column="building_full_name"		jdbcType="VARCHAR"/>		<result property="custId"				column="cust_id"				jdbcType="VARCHAR"/>		<result property="custName"				column="cust_name"				jdbcType="VARCHAR"/>		<result property="projectId"			column="project_id"				jdbcType="VARCHAR"/>		<result property="billId"				column="bill_id"				jdbcType="VARCHAR"/>		<result property="wyAmount"			 	column="wy_amount"				jdbcType="DOUBLE"/>		<result property="btAmount"			 	column="bt_amount"				jdbcType="DOUBLE"/>		<result property="waterAmount"			column="water_amount"			jdbcType="DOUBLE"/>		<result property="electAmount"			column="elect_amount"			jdbcType="DOUBLE"/>		<result property="serviceAmount"		column="service_amount"			jdbcType="DOUBLE"/>	</resultMap>		<sql id="sql_search_where">		<if test="null != id"> 		and id = #{id}				</if>		<if test="null != headId">	and head_id = #{headId}		</if>		<if test="null != buildingCode"> and building_code = #{buildingCode} </if>		<if test="null != billId"> and bill_id = #{billId}		</if>	</sql>		<sql id="sql_update">		<set>			<if test="null != buildingCode"> building_code = #{buildingCode}, </if>			<if test="null != buildingFullName"> building_full_name = #{buildingFullName}, </if>			<if test="null != billId"> bill_id = #{billId},	</if>			<if test="null != wyAmount"> wy_amount = #{wyAmount}, </if>			<if test="null != btAmount"> bt_amount = #{btAmount}, </if>			<if test="null != waterAmount"> water_amount = #{waterAmount}, </if>			<if test="null != electAmount"> elect_amount = #{electAmount}, </if>			<if test="null != serviceAmount"> service_amount = #{serviceAmount}, </if>			modify_time = sysdate()		</set>	</sql>		<select id="listPage" parameterType="TBcUnionBackBody" resultMap="BaseResultMap">		select t1.* from t_bc_union_back_body t1		<if test="null != searchCode">			,tc_building t2		</if>		where 1 = 1		<if test="null != id"> 		and t1.id = #{id}				</if>		<if test="null != headId">	and t1.head_id = #{headId}		</if>		<if test="null != buildingCode"> t1.and building_code = #{buildingCode} </if>		<if test="null != billId"> and t1.bill_id = #{billId}		</if>		<if test="null != searchCode">			and t1.building_code = t2.building_code			and t2.house_code like CONCAT('%',#{searchCode,jdbcType=VARCHAR},'%')		</if>	</select>		<select id="findByObj" parameterType="TBcUnionBackBody" resultMap="BaseResultMap">		select * from t_bc_union_back_body		where 1 = 1		<include refid="sql_search_where"/>	</select>	<insert id="batchInsert" parameterType="TBcUnionBackBody">		insert into t_bc_union_back_body		(			id,			head_id,			bank_no,			trade_date,			order_no,			trade_status,			resp_code,			is_bank_card,			bank_card_no,			amount,			`use`,			private_zone,			create_id,			create_time,			modify_id,			modify_time,			building_code,			building_full_name,			cust_id,			cust_name,			project_id,			bill_id,			wy_amount,			bt_amount,			water_amount,			elect_amount,			service_amount		)		values		<foreach collection="list" item="body" open="" close="" separator=",">		(			<if test="null != body.id"> #{body.id}, 	</if>			<if test="null == body.id"> UPPER(UUID()),	</if>			#{body.headId},			#{body.bankNo},			#{body.tradeDate},			#{body.orderNo},			#{body.tradeStatus},			#{body.respCode},			#{body.isBankCard},			#{body.bankCardNo},			#{body.amount},			#{body.use},			#{body.privateZone},			#{body.createId},			#{body.createTime},			#{body.modifyId},			#{body.modifyTime},			#{body.buildingCode},			#{body.buildingFullName},			#{body.custId},			#{body.custName},			#{body.projectId},			#{body.billId},			#{body.wyAmount},			#{body.btAmount},			#{body.waterAmount},			#{body.electAmount},			#{body.serviceAmount}		)		</foreach>	</insert>	<update id="update" parameterType="TBcUnionBackBody">		update t_bc_union_back_body 		<include refid="sql_update"/>		where id = #{id}	</update>			<select id="findByHeadIdAndOrderNo" resultMap="BaseResultMap">		select * from t_bc_union_back_body		where head_id = #{headId}		  and order_no = #{orderNo}	</select>		<select id="countTotalCountByTotalId" parameterType="String" resultType="Integer">		SELECT COUNT(t2.id) FROM t_bc_union_collection_head t1, t_bc_union_collection_body t2		WHERE t1.id = t2.head_id		AND t1.total_id = #{0}	</select>		<select id="findCollingDatasByTotalId" resultType="String">		SELECT t1.building_full_name 		  FROM tc_building t1, 		       t_bc_union_back_body t2, t_bc_union_back_head t3,		       t_bc_union_collection_body t4, t_bc_union_collection_head t5		 WHERE t1.building_code = t2.building_code		   AND t1.building_code = t4.building_code		   AND t2.head_id = t3.id		   AND t4.head_id = t5.id		   AND t3.total_id = t5.total_id		   AND t2.trade_status != "1001" 		   AND t2.resp_code != "00"		   AND t3.total_id = #{totalId}		   AND t2.building_code IN		   <foreach collection="buildingCodes" item="buildingCode" open="(" separator="," close=")">		   		#{buildingCode}		   </foreach>	</select>		<select id="getSuccessDatasByTotalId" parameterType="String" resultType="java.util.Map">		SELECT 		     CAST(SUM(t3.amount - t3.service_amount) AS DECIMAL(10,2)) AS amount,		     CAST(SUM(t3.wy_amount) AS DECIMAL(10,2)) AS wy_amount,		     CAST(SUM(t3.bt_amount) AS DECIMAL(10,2)) AS bt_amount,		     CAST(SUM(t3.water_amount) AS DECIMAL(10,2)) AS water_amount,		     CAST(SUM(t3.elect_amount) AS DECIMAL(10,2)) AS elect_amount		FROM t_bc_union_collection_body t1		LEFT JOIN t_bc_union_collection_head t2 ON t1.head_id = t2.id		LEFT JOIN t_bc_union_back_body t3 ON t3.building_code = t1.building_code		LEFT JOIN t_bc_union_back_head t4 ON t3.head_id = t4.id		WHERE t2.total_id = #{totalId}		AND t3.trade_status = 1001 		AND t3.resp_code = "00"		AND t2.total_id = t4.total_id	</select>	</mapper>