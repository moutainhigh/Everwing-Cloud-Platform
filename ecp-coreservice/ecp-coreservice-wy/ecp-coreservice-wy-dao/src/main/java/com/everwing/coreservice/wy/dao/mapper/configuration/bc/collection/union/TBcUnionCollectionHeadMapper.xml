<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.everwing.coreservice.wy.dao.mapper.configuration.bc.collection.union.TBcUnionCollectionHeadMapper" >	<resultMap type="TBcUnionCollectionHead" id="BaseResultMap">		<result property="id" 			column="id"				jdbcType="VARCHAR"/>		<result property="projectId" 	column="project_id"		jdbcType="VARCHAR"/>		<result property="projectName" 	column="project_name"	jdbcType="VARCHAR"/>		<result property="totalId" 		column="total_id"		jdbcType="VARCHAR"/>		<result property="type" 		column="type"			jdbcType="TINYINT"/>		<result property="shopNum" 		column="shop_num"		jdbcType="VARCHAR"/>		<result property="batchNo" 		column="batch_no"		jdbcType="VARCHAR"/>		<result property="totalCount" 	column="total_count"	jdbcType="INTEGER"/>		<result property="totalAmount" 	column="total_amount"	jdbcType="DOUBLE"/>		<result property="createTime" 	column="create_time"	jdbcType="TIMESTAMP"/>		<result property="createId"		column="create_id"		jdbcType="VARCHAR"/>		<result property="modifyTime" 	column="modify_time"	jdbcType="TIMESTAMP"/>		<result property="modifyId" 	column="modify_id"		jdbcType="VARCHAR"/>	</resultMap>		<resultMap type="TBcUnionCollectionHead" id="hasBodiesMap" extends="BaseResultMap">		<collection property="bodies" column="id" ofType="TBcUnionCollectionBody" javaType="java.util.ArrayList"			select="com.everwing.coreservice.wy.dao.mapper.configuration.bc.collection.union.TBcUnionCollectionBodyMapper.findFailedBodies"/>	</resultMap>		<sql id="sql_search_where">		<if test="null != id">			and id = #{id} 											</if>		<if test="null != projectId ">	and project_id = #{projectId}							</if>		<if test="null != projectName"> and project_name like CONCAT('%',#{projectName},'%')	</if>		<if test="null != totalId">		and total_id = #{totalId}								</if>		<if test="null != shopNum"> 	and shop_num = #{shopNum}								</if>		<if test="null != startTime">   <![CDATA[ and create_time >= #{startTime}]]> 			</if>		<if test="null != endTime">		<![CDATA[ and create_time <= #{endTime}]]>				</if>	</sql>		<sql id="sql_update">		<set>			<if test="null != projectId"> project_id = #{projectId},  </if>			<if test="null != projectName"> project_name = #{projectName},  </if>			<if test="null != totalId"> total_id = #{totalId} , </if>			<if test="null != type"> type = #{type} , </if>			<if test="null != shopNum"> shop_num = #{shopNum}, </if>			<if test="null != batchNo"> batch_no = #{batchNo}, </if>			<if test="null != totalCount"> total_count = #{totalCount}, </if>			<if test="null != totalAmount"> total_amount = #{totalAmount} , </if>			<if test="null != modifyId"> modify_id = #{modifyId}, </if>			modify_time = sysdate()		</set>	</sql>		<select id="listPage" parameterType="TBcUnionCollectionHead" resultMap="BaseResultMap">		select * from t_bc_union_collection_head		where 1 = 1			<include refid="sql_search_where"/>	</select>	<select id="findAllByObj" parameterType="TBcUnionCollectionHead" resultMap="hasBodiesMap">		select * from t_bc_union_collection_head		where 1 = 1		<include refid="sql_search_where"/>	</select>	<insert id="insert" parameterType="TBcUnionCollectionHead">		insert into t_bc_union_collection_head		(			id, 			project_id,			project_name,			total_id,			type,			shop_num,			batch_no,			total_count,			total_amount,			create_time,			create_id,			modify_time,			modify_id			)		values(			#{id},			#{projectId},			#{projectName},			#{totalId},			#{type},			#{shopNum},			(SELECT * FROM (			  				SELECT LPAD(									(SELECT MAX(batch_no)+1 FROM t_bc_union_collection_head)							,6,0) 							FROM dual			  				) t  			),			#{totalCount},			#{totalAmount},			#{createTime},			#{createId},			#{modifyTime},			#{modifyId}		)	</insert>	<update id="update" parameterType="TBcUnionCollectionHead">		update t_bc_union_collection_head		<include refid="sql_update"/>		where id = #{id}	</update>		<update id="updateShopNum">		update t_bc_union_collection_head		   set shop_num = #{shopNum},		       modify_time = sysdate(),		       modify_id = #{modifyId}		 where project_id = #{projectId}	</update>		<select id="findByTotalId" parameterType="String" resultMap="BaseResultMap">		select * from t_bc_union_collection_head		where total_id = #{0}		order by create_time desc		limit 0, 1	</select>		<select id="findTheEarliestHeadByTotalId" parameterType="String" resultMap="BaseResultMap">		select * from t_bc_union_collection_head		where total_id = #{0}		order by create_time asc		limit 0, 1	</select>	</mapper>