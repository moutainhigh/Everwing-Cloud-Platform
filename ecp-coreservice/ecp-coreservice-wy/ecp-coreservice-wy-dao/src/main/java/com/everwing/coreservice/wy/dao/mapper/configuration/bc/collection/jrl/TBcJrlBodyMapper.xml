<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.everwing.coreservice.wy.dao.mapper.configuration.bc.collection.jrl.TBcJrlBodyMapper" >    <resultMap type="TBcJrlBody" id="BaseResultMap">		<result property="id" 					column="id"						jdbcType="VARCHAR"/>		<result property="headId" 				column="head_id"				jdbcType="VARCHAR"/>		<result property="billId" 				column="bill_id"				jdbcType="VARCHAR"/>		<result property="buildingCode" 		column="building_code"			jdbcType="VARCHAR"/>		<result property="buildingFullName" 	column="building_full_name"		jdbcType="VARCHAR"/>		<result property="custId" 				column="cust_id"				jdbcType="VARCHAR"/>		<result property="custName" 			column="cust_name"				jdbcType="VARCHAR"/>		<result property="projectId" 			column="project_id"				jdbcType="VARCHAR"/>		<result property="type" 				column="type"					jdbcType="INTEGER"/>		<result property="detailNo" 			column="detail_no"				jdbcType="VARCHAR"/>		<result property="agreementNo" 			column="agreement_no"			jdbcType="VARCHAR"/>		<result property="amount" 				column="amount"					jdbcType="DOUBLE"/>		<result property="bankType" 			column="bank_type"				jdbcType="INTEGER"/>		<result property="bankCode" 			column="bank_code"				jdbcType="VARCHAR"/>		<result property="account" 				column="account"				jdbcType="VARCHAR"/>		<result property="accountName" 			column="account_name"			jdbcType="VARCHAR"/>		<result property="ps" 					column="PS"						jdbcType="VARCHAR"/>		<result property="bankRespCode" 		column="bank_resp_code"			jdbcType="VARCHAR"/>		<result property="remark"			 	column="remark"					jdbcType="VARCHAR"/>		<result property="bankRespPs" 			column="bank_resp_ps"			jdbcType="VARCHAR"/>		<result property="createId" 			column="create_id"				jdbcType="VARCHAR"/>		<result property="createTime" 			column="create_time"			jdbcType="TIMESTAMP"/>		<result property="modifyId" 			column="modify_id"				jdbcType="VARCHAR"/>		<result property="modifyTime" 			column="modify_time"			jdbcType="TIMESTAMP"/>		<result property="wyAmount"			 	column="wy_amount"				jdbcType="DOUBLE"/>		<result property="btAmount"			 	column="bt_amount"				jdbcType="DOUBLE"/>		<result property="waterAmount"			column="water_amount"			jdbcType="DOUBLE"/>		<result property="electAmount"			column="elect_amount"			jdbcType="DOUBLE"/>	</resultMap>		<sql id="sql_search_where">		<if test="null != id">				and id = #{id}							</if>		<if test="null != headId">			and head_id = #{headId}					</if>		<if test="null != billId">			and bill_id = #{billId}					</if>		<if test="null != buildingCode">	and building_code = #{buildingCode}		</if>		<if test="null != projectId">		and project_id = #{projectId}			</if>	</sql>		<sql id="sql_update">		<set>			<if test="null != headId"> head_id = #{headId},    </if>			<if test="null != billId"> bill_id = #{billId},	   </if>			<if test="null != buildingCode"> building_code = #{buildingCode},  </if>			<if test="null != buildingFullName"> building_full_name = #{buildingFullName},  </if>			<if test="null != custId"> cust_id = #{custId}, </if>			<if test="null != custName"> cust_name = #{custName}, </if>			<if test="null != projectId"> project_id = #{projectId}, </if>			<if test="null != type"> type = #{type} , </if>			<if test="null != detailNo"> detail_no = #{detailNo}, </if>			<if test="null != agreementNo"> agreement_no = #{agreementNo} , </if>			<if test="null != amount"> amount = #{amount}, </if>			<if test="null != bankType"> bank_type = #{bankType}, </if>			<if test="null != bankCode"> bank_code = #{bankCode}, </if>			<if test="null != account"> account = #{account}, </if>			<if test="null != accountName"> account_name = #{accountName}, </if>			<if test="null != ps"> ps = #{ps}, </if>			<if test="null != bankRespCode"> bank_resp_code = #{bankRespCode}, </if>			<if test="null != remark"> remark = #{remark}, </if>			<if test="null != bankRespPs"> bank_resp_ps = #{bankRespPs}, </if>			<if test="null != modifyId"> modify_id = #{modifyId}, </if>			<if test="null != wyAmount"> wy_amount = #{wyAmount}, </if>			<if test="null != btAmount"> bt_amount = #{btAmount}, </if>			<if test="null != waterAmount"> water_amount = #{waterAmount}, </if>			<if test="null != electAmount"> elect_amount = #{electAmount}, </if>			modify_time = sysdate()		</set>	</sql>		<select id="listPage" parameterType="TBcJrlBody" resultMap="BaseResultMap">		select 			   t.id,			   t.head_id,			   t.bill_id,			   t.building_code,			   t.building_full_name,			   t.cust_id,			   t.cust_name,			   t.project_id,			   t.type,			   t.detail_no,			   t.agreement_no,			   t.amount,			   t1.bank_name as bank_code,			   t.account,			   t.account_name,			   t.PS,			   t.bank_resp_code,			   t.remark,			   t.bank_resp_ps,			   t.create_id,			   t.create_time,			   t.modify_id,			   t.modify_time		  from t_bc_jrl_body t,		   t_bank_info t1		<if test="null != searchCode">			,tc_building t2		</if> 		where 1 = 1		and (					(t.bank_type = "00" AND t.bank_code = t1.bank_no)			  OR 					(t.bank_type = t1.bank_type)		    )		<if test="null != id">				and t.id = #{id}							</if>		<if test="null != headId">			and t.head_id = #{headId}					</if>		<if test="null != billId">			and t.bill_id = #{billId}					</if>		<if test="null != buildingCode">	and t.building_code = #{buildingCode}		</if>		<if test="null != projectId">		and t.project_id = #{projectId}				</if>		<if test="null != searchCode">			and t.building_code = t2.building_code			and t2.house_code like CONCAT('%',#{searchCode,jdbcType=VARCHAR},'%')		</if>	</select>		<select id="findByHeadId" parameterType="String" resultMap="BaseResultMap">		select * 		  from t_bc_jrl_body 		 where head_id = #{0} 		 ORDER BY CAST(detail_no AS SIGNED) asc	</select>		<select id="findFailedBodies" parameterType="String" resultMap="BaseResultMap">			SELECT tt1.* 			  FROM (								SELECT t1.* FROM t_bc_jrl_body t1,								t_bc_jrl_head t2 								WHERE t1.type = 0 								AND t1.head_id = t2.id 								AND t2.id = #{headId}							) tt1 		       LEFT JOIN 							( 								SELECT t3.building_code 								FROM t_bc_jrl_body t3,t_bc_jrl_head t4,t_bc_jrl_head t5 								WHERE t3.head_id = t4.id 								AND t4.total_id = t5.total_id 								AND t5.id = #{headId}								AND t4.type = 1 								AND t5.type = 0 								AND t3.bank_resp_code = 'FSBR0000'							 ) tt2				ON tt1.building_code = tt2.building_code			 WHERE tt2.building_code IS NULL			 ORDER BY CAST(tt1.detail_no AS SIGNED) ASC	</select>		<select id="findByObj" parameterType="TBcJrlBody" resultMap="BaseResultMap">		select * from t_bc_jrl_body		where 1 = 1		<include refid="sql_search_where"/>	</select>		<update id="update"  parameterType="TBcJrlBody">		update t_bc_jrl_body		<include refid="sql_update"/>		where id = #{id}	</update>		<insert id="insert" parameterType="TBcJrlBody">		insert into t_bc_jrl_body			(				id,				head_id,				bill_id,				building_code,				building_full_name,				cust_id,				cust_name,				project_id,				type,				detail_no,				agreement_no,				amount,				bank_type,				bank_code,				account,				account_name,				ps,				bank_resp_code,				remark,				bank_resp_ps,				create_id,				create_time,				modify_id,				modify_time,				wy_amount,				bt_amount,				water_amount,				elect_amount			)			values			(				#{id},				#{headId},				#{billId},				#{buildingCode},				#{buildingFullName},				#{custId},				#{custName},				#{projectId},				#{type},				#{detailNo},				#{agreementNo},				#{amount},				#{bankType},				#{bankCode},				#{account},				#{accountName},				#{ps},				#{bankRespCode},				#{remark},				#{bankRespPs},				#{createId},				#{createTime},				#{modifyId},				#{modifyTime},				#{wyAmount},				#{btAmount},				#{waterAmount},				#{electAmount}			)	</insert>		<insert id="batchInsert" parameterType="TBcJrlBody">		insert into t_bc_jrl_body		(			id,			head_id,			bill_id,			building_code,			building_full_name,			cust_id,			cust_name,			project_id,			type,			detail_no,			agreement_no,			amount,			bank_type,			bank_code,			account,			account_name,			ps,			bank_resp_code,			remark,			bank_resp_ps,			create_id,			create_time,			modify_id,			modify_time,			wy_amount,			bt_amount,			water_amount,			elect_amount		)		values		<foreach collection="list" item="body" open="" close="" separator=",">		(			#{body.id},			#{body.headId},			#{body.billId},			#{body.buildingCode},			#{body.buildingFullName},			#{body.custId},			#{body.custName},			#{body.projectId},			#{body.type},			#{body.detailNo},			#{body.agreementNo},			#{body.amount},			#{body.bankType},			#{body.bankCode},			#{body.account},			#{body.accountName},			#{body.ps},			#{body.bankRespCode},			#{body.remark},			#{body.bankRespPs},			#{body.createId},			#{body.createTime},			#{body.modifyId},			#{body.modifyTime},			#{body.wyAmount},			#{body.btAmount},			#{body.waterAmount},			#{body.electAmount}		)		</foreach>	</insert>				<update id="batchUpdate" parameterType = "TBcJrlBody">		<foreach collection="list" item="body" open="" close=";" separator=";">			update t_bc_jrl_body set PS = #{body.ps} where id = #{body.id}		</foreach>	</update>			<select id="findByHeadIdAndAgreementNo" resultMap="BaseResultMap">		select * from t_bc_jrl_body		 where head_id = #{headId}		   and agreement_no = #{agreementNo}	</select>		<select id="countByHeadIdAndType" resultType="Integer">		SELECT COUNT(0) FROM t_bc_jrl_body WHERE head_id = #{headId} AND TYPE = #{type}	</select>	<select id="sumAmountByHeadIdAndType" resultType="Double">		SELECT SUM(amount) FROM t_bc_jrl_body WHERE head_id = #{headId} AND TYPE = #{type}	</select>		<select id="sumTotalAmountByTotalId" parameterType="String" resultType="Double">		SELECT SUM(t2.amount)		FROM t_bc_jrl_head t1 , t_bc_jrl_body t2		WHERE t1.id = t2.head_id		AND t1.total_id = #{0}	</select>		<select id="countTotalCountByTotalId" parameterType="String" resultType="Integer">		SELECT COUNT(t2.id) FROM t_bc_jrl_head t1, t_bc_jrl_body t2		WHERE t1.id = t2.head_id 		AND t1.total_id = #{0}	</select>		<select id="findCollingDatasByTotalId" resultType="String">		SELECT t5.building_full_name FROM t_bc_jrl_body t1, t_bc_jrl_body t2, t_bc_jrl_head t3, t_bc_jrl_head t4,tc_building t5		WHERE t1.head_id = t3.id		AND t2.head_id = t4.id		AND t3.type = 1		AND t4.type = 0		AND t3.total_id = t4.total_id		AND t1.building_code = t2.building_code		AND t1.building_code = t5.building_code		AND t4.total_id = #{totalId}		AND t1.bank_resp_code != "FSBR0000"		AND t1.building_code in		<foreach collection="buildingCodes" item="buildingCode" open="(" separator="," close=")">			#{buildingCode}		</foreach>	</select>		<select id="getSuccessDatasByTotalId" parameterType="String" resultType="java.util.Map">		SELECT   		       CAST(SUM(t3.amount) AS DECIMAL(10,2)) AS amount,		       CAST(SUM(t3.wy_amount) AS DECIMAL(10,2)) AS wy_amount,		       CAST(SUM(t3.bt_amount) AS DECIMAL(10,2)) AS bt_amount,		       CAST(SUM(t3.water_amount) AS DECIMAL(10,2)) AS water_amount,		       CAST(SUM(t3.elect_amount) AS DECIMAL(10,2)) AS elect_amount		 FROM t_bc_jrl_body t3 		 LEFT JOIN t_bc_jrl_head t5 ON t3.head_id = t5.id		WHERE t3.type = 1		  AND t5.total_id = #{totalId}		  AND t3.bank_resp_code = "FSBR0000"	</select>			<!-- 快付通托收回盘用 -->	<select id="getCollBodyByTotalIdAndBuildingCoded" resultMap = "BaseResultMap">		SELECT			*		FROM			t_bc_jrl_body		WHERE			head_id IN (				SELECT					id				FROM					t_bc_jrl_head				WHERE					total_id = #{totalId}				AND type = 0			)		AND building_code = #{buildingCode}				</select></mapper>