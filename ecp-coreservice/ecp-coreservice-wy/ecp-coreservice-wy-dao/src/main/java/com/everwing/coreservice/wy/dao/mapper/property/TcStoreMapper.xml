<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.everwing.coreservice.wy.dao.mapper.property.TcStoreMapper">	<!-- 基本视图 -->	<resultMap id="BaseResultMap" type="TcStore">		<result property="id" column="id"/>		<result property="buildingCode" column="building_code"/>		<result property="storeName" column="store_name"/>		<result property="storeType" column="store_type"/>		<result property="createrId" column="creater_id"/>		<result property="createrName" column="creater_name"/>		<result property="modifyId" column="modify_id"/>		<result property="modifyName" column="modify_name"/>		<result property="createTime" column="create_time"/>		<result property="modifyTime" column="modify_time"/>	</resultMap>	<!-- 自定义视图  -->	<resultMap id="ListResultMap" type="TcStoreList" extends="BaseResultMap">		<result property="storeFullName" column="building_full_name"/>		<result property="marketStateName" column="market_state_name"/>		<result property="storeTypeName" column="store_type_name"/>	</resultMap>	<select id="listPageStore" parameterType="TcStoreSearch" resultMap="ListResultMap">		SELECT			s.id,			s.store_name,			s.store_type,			b.building_code,			b.house_code AS store_code,			b.building_full_name AS building_full_name,			b.building_area,			b.usable_area,			b.share_area,			b.finish_date,			b.building_certificate,			b.unit_wy_price,			b.unit_bt_price,			b.market_state,			(SELECT li.`name` FROM t_sys_lookup_item li WHERE li.parent_code = '${@com.everwing.coreservice.common.wy.common.enums.LookupEnum@marketState.name()}' AND li.`code` = b.market_state) as market_state_name,			(SELECT li.`name` FROM t_sys_lookup_item li WHERE li.parent_code = '${@com.everwing.coreservice.common.wy.common.enums.LookupEnum@storeType.name()}' AND li.`code` = s.store_type) as store_type_name		FROM tc_building b LEFT JOIN tc_store s ON s.building_code = b.building_code WHERE 1=1		<if test="buildingCode != null and buildingCode != ''">			AND b.building_code = #{buildingCode}		</if>		<if test="projectCode != null and projectCode != ''">			AND b.project_id = #{projectCode}		</if>		ORDER BY b.house_code ASC	</select>	<!-- 获取指定条件的信息集合 -->	<select id="findByCondition" parameterType="TcStoreSearch" resultMap="ListResultMap">		SELECT			s.*,			b.building_full_name			(SELECT li.`name` FROM t_sys_lookup_item li WHERE li.parent_code = '${@com.everwing.coreservice.common.wy.common.enums.LookupEnum@marketState.name()}' AND li.`code` = s.market_state) as market_state_name,			(SELECT li.`name` FROM t_sys_lookup_item li WHERE li.parent_code = '${@com.everwing.coreservice.common.wy.common.enums.LookupEnum@storeType.name()}' AND li.`code` = s.store_type) as store_type_name		FROM tc_building b,tc_store s WHERE s.building_code = b.building_code		<if test="buildingCode != null and buildingCode != ''">			AND b.building_code = #{buildingCode}		</if>		<if test="id != null and id != ''">			AND s.id = #{id}		</if>		<if test="projectCode != null and projectCode != ''">			AND b.project_id = #{projectCode}		</if>		ORDER BY b.house_code ASC	</select>	<!-- 统计住宅信息 -->	<select id="countStore" parameterType="String" resultType="CountStoreList">		SELECT			ROUND(SUM(s.building_area),2) AS buildingArea,			ROUND(SUM(s.usable_area),2) AS usableAreaSum,			ROUND(SUM(s.share_area),2) AS shareAreaSum,			ROUND(SUM(s.finish_area),2) AS finishAreaSum,			COUNT(*) AS allCount,			SUM(s.market_state = '002') AS soldCount		FROM tc_building s		WHERE s.project_id = #{0} AND s.building_type = 'store' AND s.building_full_name LIKE  CONCAT(#{1},'%')	</select>	<!-- 单个添加 -->	<insert id="insert"  parameterType="TcStore">		INSERT INTO tc_store (			id,			building_code,			store_name,			store_type,			creater_id,			creater_name,			modify_id,			modify_name,			create_time,			modify_time		) Values(			UUID(),			#{buildingCode},			#{storeName},			#{storeType},			#{createrId},			#{createrName},			#{modifyId},			#{modifyName},			sysdate(),			sysdate()		)	</insert>	<!-- 批量添加 -->	<insert id="batchInsert" parameterType="java.util.List">		insert into tc_store(			id,			building_code,			store_name,			store_type,			creater_id,			creater_name,			modify_id,			modify_name,			create_time,			modify_time		)		values		<foreach collection="list" index="index" item="item" separator=",">			(				UUID(),				#{item.buildingCode},				#{item.storeName},				#{item.storeType},				#{item.createrId},				#{item.createrName},				#{item.modifyId},				#{item.modifyName},				sysdate(),				sysdate()			)		</foreach>	</insert>	<!-- 单个修改 -->	<update id="modify" parameterType="TcStore" >		UPDATE tc_store		<set>			store_name = #{storeName},			store_type = #{storeType},			modify_id = #{modifyId},			modify_name = #{modifyName},			modify_time = sysdate()		</set>		where 1=1		<if test="id != null and id != ''">			AND id = #{id}		</if>		<if test="buildingCode != null and buildingCode != ''">			AND building_code = #{buildingCode}		</if>	</update>	<update id="batchModify" parameterType="java.util.List">		<foreach collection="list" separator=";" index="index" item="item">			UPDATE tc_store SET				store_name = #{item.storeName},				store_type = #{item.storeType},				modify_id = #{item.modifyId},				modify_name = #{item.modifyName},				modify_time = sysdate()			WHERE 1=1			<if test="item.id != null and item.id != ''">				AND id = #{item.id}			</if>			<if test="item.buildingCode != null and item.buildingCode != ''">				AND building_code = #{item.buildingCode}			</if>		</foreach>	</update>	<!-- 批量删除  -->	<delete id="batchDelete" parameterType="java.util.List">		delete from tc_store where building_code IN		<foreach collection="list" item = "buildingCode" open="(" separator="," close=")">			#{buildingCode }		</foreach>	</delete>		<select id="findByBuildingCode" parameterType="String" resultMap="BaseResultMap">		select unit_wy_price,			   unit_bt_price,			   building_area,			   usable_Area	     from tc_store	    where building_code = #{0}	</select></mapper>