<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.everwing.coreservice.wy.dao.mapper.configuration.bc.collection.jrl.TBcJrlHeadMapper" >    <resultMap type="TBcJrlHead" id="BaseResultMap">		<result property="id" 					column="id"						jdbcType="VARCHAR"/>		<result property="totalId" 				column="total_id"				jdbcType="VARCHAR"/>		<result property="collId" 				column="coll_id"				jdbcType="VARCHAR"/>		<result property="type" 				column="type"					jdbcType="INTEGER"/>		<result property="projectId" 			column="project_id"				jdbcType="VARCHAR"/>		<result property="projectName" 			column="project_name"			jdbcType="VARCHAR"/>		<result property="companyId" 			column="company_id"				jdbcType="VARCHAR"/>		<result property="businessType" 		column="business_type"			jdbcType="INTEGER"/>		<result property="enterpriseNo" 		column="enterprise_no"			jdbcType="VARCHAR"/>		<result property="bankNo" 				column="bank_no"				jdbcType="VARCHAR"/>		<result property="feeNo" 				column="fee_no"					jdbcType="VARCHAR"/>		<result property="fileName" 			column="file_name"				jdbcType="VARCHAR"/>		<result property="feeType" 				column="fee_type"				jdbcType="INTEGER"/>		<result property="totalCount" 			column="total_count"			jdbcType="INTEGER"/>		<result property="totalAmount" 			column="total_amount"			jdbcType="DOUBLE"/>		<result property="completeCount" 		column="complete_count"			jdbcType="INTEGER"/>		<result property="completeAmount" 		column="complete_amount"		jdbcType="DOUBLE"/>		<result property="businessNo" 			column="business_no"			jdbcType="VARCHAR"/>		<result property="requestDate" 			column="request_date"			jdbcType="TIMESTAMP"/>		<result property="payDate" 				column="pay_date"				jdbcType="TIMESTAMP"/>		<result property="responseDate" 		column="response_date"			jdbcType="TIMESTAMP"/>		<result property="chargeAccount" 		column="charge_account"			jdbcType="VARCHAR"/>		<result property="chargeAccountName" 	column="charge_account_name"	jdbcType="VARCHAR"/>		<result property="createId" 			column="create_id"				jdbcType="VARCHAR"/>		<result property="createTime" 			column="create_time"			jdbcType="TIMESTAMP"/>		<result property="modifyId" 			column="modify_id"				jdbcType="VARCHAR"/>		<result property="modifyTime" 			column="modify_time"			jdbcType="TIMESTAMP"/>	</resultMap>		<resultMap type="TBcJrlHead" id="hasBodiesResultMap" extends="BaseResultMap">		<collection property="bodies" column="id" ofType="TBcJrlBody" javaType="java.util.ArrayList"			select="com.everwing.coreservice.wy.dao.mapper.configuration.bc.collection.jrl.TBcJrlBodyMapper.findFailedBodies"/>	</resultMap>	<sql id="sql_search_where">		<if test="null != id">				and id = #{id} 						</if>		<if test="null != totalId">			and total_id = #{totalId}			</if>		<if test="null != companyId">		and company_id = #{companyId}		</if>		<if test="null != projectId">		and project_id = #{projectId}		</if>		<if test="null != collId">			and coll_id = #{collId}				</if>		<if test="null != bankNo">			and bank_no = #{bankNo}				</if>		<if test="null != type">			and type = #{type}					</if>		<if test="null != startTime"><![CDATA[ and create_time >= #{startTime}	]]></if>		<if test="null != endTime">  <![CDATA[ and create_time <= #{endTime}	]]></if>		<if test="null != fileName">		and file_name = #{fileName}			</if>	</sql>		<select id="listPage" parameterType="TBcJrlHead" resultMap="BaseResultMap">		SELECT 				t1.id,				t1.total_id,				t1.coll_id,				t1.type,				t1.project_id,				t1.project_name,				t1.company_id,				t1.business_type,				t1.enterprise_no,				t1.fee_no,				t1.file_name,				t1.fee_type,				t1.total_count,				t1.total_amount,				t1.complete_count,				t1.complete_amount,				t1.business_no,				t1.request_date,				t1.pay_date,				t1.response_date,				t1.charge_account,				t1.charge_account_name,				t1.create_id,				t1.create_time,				t1.modify_id,				t1.modify_time,				t2.bank_name AS bank_no		  FROM t_bc_jrl_head t1,		       t_bank_info t2  			   <if test="null != searchCode">			       , t_bc_jrl_body t3, tc_building t4			   </if>		where 1 = 1		and (				(t1.bank_no = t2.bank_no AND t2.bank_no IS NOT NULL)			OR 			    (t1.bank_no = t2.bank_type AND t2.bank_type IS NOT NULL)		)		<if test="null != id">				and t1.id = #{id} 						</if>		<if test="null != totalId">			and t1.total_id = #{totalId}			</if>		<if test="null != companyId">		and t1.company_id = #{companyId}		</if>		<if test="null != projectId">		and t1.project_id = #{projectId}		</if>		<if test="null != collId">			and t1.coll_id = #{collId}				</if>		<if test="null != bankNo">			and t1.bank_no = #{bankNo}				</if>		<if test="null != type">			and t1.type = #{type}					</if>		<if test="null != startTime"><![CDATA[ and t1.create_time >= #{startTime}	]]></if>		<if test="null != endTime">  <![CDATA[ and t1.create_time <= #{endTime}	    ]]></if>		<if test="null != fileName">		and t1.file_name = #{fileName}			</if>		<if test="null != searchCode">			and t3.head_id = t1.id			and t3.building_code = t4.building_code			and t4.house_code like CONCAT('%',#{searchCode,jdbcType=VARCHAR},'%')		</if>	</select>		<select id="findByObj" parameterType="TBcJrlHead" resultMap="hasBodiesResultMap">		select * from t_bc_jrl_head		where 1 = 1		<include refid="sql_search_where"/>	</select>		<update id="update" parameterType="TBcJrlHead">		update t_bc_jrl_head 		<set>			<if test="null != totalId"> total_id = #{totalId}, </if>			<if test="null != collId"> coll_id = #{collId}, </if>			<if test="null != type"> type = #{type}, </if>			<if test="null != projectId"> project_id = #{projectId}, </if>			<if test="null != projectName"> project_name = #{projectName},</if>			<if test="null != businessType"> business_type = #{businessType}, </if>			<if test="null != enterpriseNo"> enterprise_no = #{enterpriseNo}, </if>			<if test="null != bankNo"> bank_no = #{bankNo}, </if>			<if test="null != feeNo"> fee_no = #{feeNo}, </if>			<if test="null != fileName"> file_name = #{fileName}, </if>			<if test="null != feeType"> fee_type = #{feeType},</if>			<if test="null != totalCount"> total_count = #{totalCount}, </if>			<if test="null != totalAmount"> total_amount = #{totalAmount}, </if>			<if test="null != completeCount"> complete_count = #{completeCount},</if>			<if test="null != completeAmount"> complete_amount = #{completeAmount}, </if>			<if test="null != businessNo"> business_no = #{businessNo},</if>			<if test="null != requestDate"> request_date = #{requestDate},</if>			<if test="null != payDate"> pay_date = #{payDate},</if>			<if test="null != responseDate"> response_date = #{responseDate},</if>			<if test="null != chargeAccount"> charge_account = #{chargeAccount},</if>			<if test="null != chargeAccountName"> charge_account_name = #{chargeAccountName},</if>			<if test="null != modifyId"> modify_id = #{modifyId},</if>			modify_time = sysdate()		</set>		where id = #{id}	</update>		<insert id="insert" parameterType="TBcJrlHead">		insert into t_bc_jrl_head		(			id,			total_id,			coll_id,			type,			project_id,			project_name,			company_id,			business_type,			enterprise_no,			bank_no,			fee_no,			file_name,			fee_type,			total_count,			total_amount,			complete_count,			complete_amount,			business_no,			request_date,			pay_date,			response_date,			charge_account,			charge_account_name,			create_id,			create_time,			modify_id,			modify_time		)		values		(			#{id},			#{totalId},			#{collId},			#{type},			#{projectId},			#{projectName},			#{companyId},			#{businessType},			#{enterpriseNo},			#{bankNo},			#{feeNo},			#{fileName},			#{feeType},			#{totalCount},			#{totalAmount},			#{completeCount},			#{completeAmount},			#{businessNo},			#{requestDate},			#{payDate},			#{responseDate},			#{chargeAccount},			#{chargeAccountName},			#{createId},			#{createTime},			#{modifyId},			#{modifyTime}		)	</insert>		<select id="findBatchNo" resultType="String">		SELECT SUBSTRING(MAX(file_name),5,4)		   FROM t_bc_jrl_head 		  WHERE `type` = 0  		    AND project_id = #{projectId}		  ORDER BY create_time DESC 		  limit 1	</select>		<select id="findByTotalIdAndType"  resultMap="BaseResultMap">		select * from t_bc_jrl_head 		 where total_id = #{totalId}		   and `type` = #{type}		 order by create_time desc		 limit 0,1	</select>	</mapper>